<!DOCTYPE html>
<html lang="en" dir="ltr" prefix="content: http://purl.org/rss/1.0/modules/content/ dc: http://purl.org/dc/terms/ foaf: http://xmlns.com/foaf/0.1/ og: http://ogp.me/ns# rdfs: http://www.w3.org/2000/01/rdf-schema# sioc: http://rdfs.org/sioc/ns# sioct: http://rdfs.org/sioc/types# skos: http://www.w3.org/2004/02/skos/core# xsd: http://www.w3.org/2001/XMLSchema#">
<head>
  <link rel="profile" href="http://www.w3.org/1999/xhtml/vocab" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../sites/all/themes/bootstrap/favicon.ico" type="image/vnd.microsoft.icon" />
<link rel="shortlink" href="persistent-data-containers-option-2.html" />
<link rel="canonical" href="persistent-data-containers-option-2.html" />
<meta name="Generator" content="Drupal 7 (http://drupal.org)" />
  <title>Persistent data containers: Option 2 | Home</title>
  <link type="text/css" rel="stylesheet" href="../sites/default/files/css/css_lQaZfjVpwP_oGNqdtWCSpJT1EMqXdMiU84ekLLxQnc4.css" media="all" />
<link type="text/css" rel="stylesheet" href="../sites/default/files/css/css_YmuMqUm--85MDg6GF8xFt60xnxOSYeKArfr5yk0-sVc.css" media="all" />
<link type="text/css" rel="stylesheet" href="../sites/default/files/css/css_MnXiytJtb186Ydycnpwpw34cuUsHaKc80ey5LiQXhSY.css" media="all" />
<link type="text/css" rel="stylesheet" href="http://cdn.jsdelivr.net/bootstrap/3.0.2/css/bootstrap.min.css" media="all" />
<link type="text/css" rel="stylesheet" href="../sites/default/files/css/css_cRAVao--tsiCNYD0CCFUWT7kPl_o4FDNgRF_jEC9PdQ.css" media="all" />
  <!-- HTML5 element support for IE6-8 -->
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <script src="../sites/default/files/js/js_oCVMDTeSNt-_QxknevWyf6yO5OzmME3AhRz3ggZgNtg.js"></script>
<script src="http://cdn.jsdelivr.net/bootstrap/3.0.2/js/bootstrap.min.js"></script>
<script src="../sites/default/files/js/js_I8yX6RYPZb7AtMcDUA3QKDZqVkvEn35ED11_1i7vVpc.js"></script>
<script>(function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,"script","//www.google-analytics.com/analytics.js","ga");ga("create", "UA-52870008-1", {"cookieDomain":"auto"});ga("set", "anonymizeIp", true);ga("send", "pageview");</script>
<script>jQuery.extend(Drupal.settings, {"basePath":"\/","pathPrefix":"","ajaxPageState":{"theme":"bootstrap","theme_token":"_U_dbaSX6y8VKHW0L1GwnW2Tx4g13Q8CpD7xTgbPjac","js":{"sites\/all\/themes\/bootstrap\/js\/bootstrap.js":1,"sites\/all\/modules\/jquery_update\/replace\/jquery\/1.10\/jquery.min.js":1,"misc\/jquery.once.js":1,"misc\/drupal.js":1,"\/\/cdn.jsdelivr.net\/bootstrap\/3.0.2\/js\/bootstrap.min.js":1,"sites\/all\/modules\/google_analytics\/googleanalytics.js":1,"0":1},"css":{"modules\/system\/system.base.css":1,"modules\/field\/theme\/field.css":1,"modules\/node\/node.css":1,"sites\/all\/modules\/views\/css\/views.css":1,"sites\/all\/modules\/ckeditor\/css\/ckeditor.css":1,"sites\/all\/modules\/ctools\/css\/ctools.css":1,"\/\/cdn.jsdelivr.net\/bootstrap\/3.0.2\/css\/bootstrap.min.css":1,"sites\/all\/themes\/bootstrap\/css\/3.0.2\/overrides.min.css":1}},"googleanalytics":{"trackOutbound":1,"trackMailto":1,"trackDownload":1,"trackDownloadExtensions":"7z|aac|arc|arj|asf|asx|avi|bin|csv|doc(x|m)?|dot(x|m)?|exe|flv|gif|gz|gzip|hqx|jar|jpe?g|js|mp(2|3|4|e?g)|mov(ie)?|msi|msp|pdf|phps|png|ppt(x|m)?|pot(x|m)?|pps(x|m)?|ppam|sld(x|m)?|thmx|qtm?|ra(m|r)?|sea|sit|tar|tgz|torrent|txt|wav|wma|wmv|wpd|xls(x|m|b)?|xlt(x|m)|xlam|xml|z|zip"},"bootstrap":{"anchorsFix":1,"anchorsSmoothScrolling":1,"formHasError":1,"popoverEnabled":1,"popoverOptions":{"animation":1,"html":0,"placement":"right","selector":"","trigger":"click","triggerAutoclose":1,"title":"","content":"","delay":0,"container":"body"},"tooltipEnabled":1,"tooltipOptions":{"animation":1,"html":0,"placement":"auto left","selector":"","trigger":"hover focus","delay":0,"container":"body"}}});</script>
</head>
<body role="document" class="html not-front not-logged-in one-sidebar sidebar-first page-node page-node- page-node-65 node-type-jeff-on-ops-blog-article">
  <div id="skip-link">
    <a href="#main-content" class="element-invisible element-focusable">Skip to main content</a>
  </div>
    <header id="navbar" role="banner" class="navbar container navbar-default">
  <div class="container">
    <div class="navbar-header">
              <a class="logo navbar-btn pull-left" href="../index.html" title="Home">
          <img src="../sites/all/themes/bootstrap/logo.png" alt="Home" />
        </a>
      
              <a class="name navbar-brand" href="../index.html" title="Home">Home</a>
      
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
          </div>

          <div class="navbar-collapse collapse">
        <nav role="navigation">
                      <ul class="menu nav navbar-nav"><li class="first leaf"><a href="../jeff-on-ops-blog.html" title="">Jeff on Ops Blog</a></li>
<li class="leaf"><a href="http://appwriter.com" title="">Pete on Dev Blog</a></li>
<li class="last expanded dropdown"><a href="wins-and-losses.html" data-target="#" class="dropdown-toggle" data-toggle="dropdown">Wins Losses <span class="caret"></span></a><ul class="dropdown-menu"><li class="first leaf"><a href="wins-and-losses.html" title="">Summary: Wins and Losses</a></li>
<li class="leaf"><a href="case-study-advanced-code-generation-and-tooling-very-large-teams.html">Case Study: Advanced Code Generation and Tooling for very large teams</a></li>
<li class="leaf"><a href="case-study-beyond-staff-augmentation-frameworks-and-automation.html">Case Study: Beyond staff augmentation - Frameworks and Automation</a></li>
<li class="leaf"><a href="case-study-big-data-etl.html">Case Study: Big Data ETL</a></li>
<li class="leaf"><a href="case-study-big-data-etl-automation.html">Case Study: Big Data ETL Automation</a></li>
<li class="leaf"><a href="case-study-converting-prototype-code-base-production-code-base.html">Case Study: Converting a Prototype Code Base Into a Production Code Base</a></li>
<li class="leaf"><a href="case-study-eating-our-own-devops-dog-food.html">Case Study: Eating Our Own Devops Dog Food</a></li>
<li class="leaf"><a href="case-study-eclipse-based-structured-notes-app.html">Case Study: Eclipse Based Structured Notes App</a></li>
<li class="leaf"><a href="case-study-how-improve-performance-already-brilliant-team.html">Case Study: How to Improve the Performance of An Already Brilliant Team</a></li>
<li class="leaf"><a href="case-study-modular-java-workspace-administration.html">Case Study: Modular Java Workspace Administration</a></li>
<li class="leaf"><a href="case-study-new-technologies-established-department.html">Case Study: New Technologies in an Established Department</a></li>
<li class="leaf"><a href="case-study-rapid-development-custom-mission-critical-software.html">Case Study: Rapid Development of Custom, Mission Critical Software</a></li>
<li class="leaf"><a href="case-study-setting-junior-programmer-finished-app-administer-and-maintain.html">Case Study: Setting up a junior programmer with a finished app to administer and maintain</a></li>
<li class="leaf"><a href="case-study-starting-scratch.html">Case Study: Starting from Scratch!</a></li>
<li class="leaf"><a href="case-study-webappwriter-helps-thousand-generate-custom-applications.html">Case Study: WebAppWriter helps thousand generate custom applications</a></li>
<li class="last leaf"><a href="natural-limitations.html">Natural Limitations</a></li>
</ul></li>
</ul>                                      </nav>
      </div>
      </div>
</header>

<div class="main-container container">

  <header role="banner" id="page-header">
    
      <div class="region region-header">
    <section id="block-block-1" class="block block-block clearfix">

      
  <p><img alt="" src="http://a.btrg.org/00datafundamentals.com/datafundamentals250simplici.gif" style="height:42px; width:250px" /><img alt="" src="http://a.btrg.org/df2015/whiteBanner.jpg" style="height:42px; width:43px" /><a href="../dev-offerings.html"><img alt="" src="http://a.btrg.org/df2015/peteBanner.jpg" /></a><a href="../ops-offerings.html"><img alt="" src="http://a.btrg.org/df2015/opsJeffBanner.jpg" /></a><a href="../df.lab.html"><img alt="" src="http://a.btrg.org/df2015/scienceBanner.jpg" /></a><a href="../unicorn-gap.html"><img alt="" src="http://a.btrg.org/df2015/unicornGapBanner.jpg" style="border-style:solid; border-width:0px" /></a></p>

</section>
  </div>
  </header> <!-- /#page-header -->

  <div class="row">

          <aside class="col-sm-3" role="complementary">
          <div class="region region-sidebar-first well">
    <section id="block-system-navigation" class="block block-system block-menu clearfix">

        <h2 class="block-title">Contents</h2>
    
  <ul class="menu nav"><li class="first leaf"><a href="../jeff-on-ops-blog.html" title="">Jeff on Ops Blog</a></li>
<li class="last leaf"><a href="wins-and-losses.html" title="">Wins and Losses</a></li>
</ul>
</section>
  </div>
      </aside>  <!-- /#sidebar-first -->
    
    <section class="col-sm-9">
                  <a id="main-content"></a>
                    <h1 class="page-header">Persistent data containers: Option 2</h1>
                                                        <article id="node-65" class="node node-jeff-on-ops-blog-article clearfix" about="/content/persistent-data-containers-option-2" typeof="sioc:Item foaf:Document">
    <header>
            <span property="dc:title" content="Persistent data containers: Option 2" class="rdf-meta element-hidden"></span>        <span class="submitted">
        <div class="user-picture">
    <img typeof="foaf:Image" class="img-responsive" src="../sites/default/files/styles/thumbnail/public/pictures/picture-11-1400705926-itok=KFQI6U-7.jpg" alt="Jeff Carapetyan&#039;s picture" title="Jeff Carapetyan&#039;s picture" />  </div>
      <span property="dc:date dc:created" content="2015-01-20T11:03:29-06:00" datatype="xsd:dateTime" rel="sioc:has_creator">Submitted by <span class="username" xml:lang="" about="/users/jeff-carapetyan" typeof="sioc:UserAccount" property="foaf:name" datatype="">Jeff Carapetyan</span> on Tue, 01/20/2015 - 11:03</span>    </span>
      </header>
    <div class="field field-name-body field-type-text-with-summary field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p><a href="persistent-data-containers-option-1.html#overlay-context=jeff-on-ops-blog">I have previously spoken about how I created persistent data containers using scripts for the setup</a>, but I figured I would also show you the other option. Rather than use scripts for the containers, use the docker-chef cookbook and store the data visibly on the VM. This won't be true data container that you can store on Dockerhub, but it will have a lot of the same benefits as running a data container.</p>
<p>For those of you who just want to look at the cookbook, <a href="https://github.com/jcarapet/df_box_smoslt">here you go</a>.</p>
<p><strong>Warning: </strong>This how-to assumes you have a basic understanding of the following before trying to run this. If you don't, then I would (not so) quickly read up on them before coming back.</p>
<ul><li>Chef and cookbook layout</li>
<li>wrapper cookbooks</li>
<li>How to use LWRP's</li>
<li>understanding of Docker basics like the difference between images, containers, and a very basic understanding of the docker API</li>
</ul><p><strong>Start with the Chef docker cookbook</strong><br />
This is pretty straightforward like in the previous post. Simply include the docker cookbook in the default.rb recipe, and download the required images using the docker_image LWRP. </p>
<p><img alt="" src="http://a.btrg.org/df2015/Screen%20Shot%202015-01-20%20at%2011.06.34%20AM.png" style="height:110px; width:200px" /></p>
<p><strong>Create directories to store your container data</strong><br />
Then, you will want to create your storage directories for where you are going to store your data. I have elected to store them in the /var/ section of the filesystem. You can set it to whatever permissions you would like, but I have set mine to 777 to avoid any permissions issues. It's not like Docker containers are inherently secure anyway...</p>
<p><img alt="" src="http://a.btrg.org/df2015/Screen%20Shot%202015-01-20%20at%2011.52.33%20AM.png" style="height:147px; width:200px" /></p>
<p><strong>Spin up your first containers</strong></p>
<p>Next, you will use the docker_container resource to build the jenkins and Nexus containers as a starting point. These will spin up containers with the filesystems that you would like to copy for your "persistent" data </p>
<p><img alt="" src="http://a.btrg.org/df2015/Screen%20Shot%202015-01-20%20at%2010.44.51%20AM.png" style="height:150px; width:250px" /></p>
<p><em>(note the commented out text in the resource. This is an attempt to install maven on the container, but it was causing the container to exit prematurely, causing cascading issues. This is a non-automated step that will be fixed in later versions of the cookbook)</em></p>
<p><strong>Copy from the container to the host</strong></p>
<p>Next, you will copy the contents from the container over to the host VM and the previously mentioned locations. There is a :cp action as part of the Docker_container LWRP, but I have found that it more often than not doesn't copy recursively, just the first file alphebetically in the directory you are trying to move. Therefore, I have elected use the execute resource with the required Docker command.<strong> NOTE</strong>: <em>if anybody has a solution to this problem, then feel free to let me know so I can adjust it.</em></p>
<p><img alt="" src="http://a.btrg.org/df2015/Screen%20Shot%202015-01-20%20at%2010.45.05%20AM.png" style="height:100px; width:270px" /></p>
<p><strong>Delete the first containers</strong></p>
<p>Next, shut down and remove the existing containers. I originally tried separating out the steps into a stop, then remove process, but found that it left "zombie containers" that affected later steps. The best solution is to use the force true method. It makes the code a lot cleaner that way anyway. </p>
<p><img alt="" src="http://a.btrg.org/df2015/Screen%20Shot%202015-01-20%20at%2010.45.32%20AM.png" style="height:90px; width:250px" /></p>
<p><strong>Spin up your "persistent" containers</strong></p>
<p>Finally, spin up new containers mounting the filesystems on the new containers. </p>
<p><img alt="" src="http://a.btrg.org/df2015/Screen%20Shot%202015-01-20%20at%2010.45.44%20AM.png" style="height:140px; width:250px" /></p>
<p>Note that I have specified port-forwarding in the container resource so I can access the servers externally. To verify that your containers are working simply type in the &lt;ip_address&gt;:&lt;port&gt; fin your browser for each server to verify it is working properly (in my case 192.168.33.42:8080 and 8081 respectively).</p>
<p>So there you go. Voila! It really is that simple. This is not a perfect solution, but one I have found that would work. </p>
<p>Keep calm, and Chef/Docker on</p>
</div></div></div>    <footer>
    <div class="field field-name-field-tags field-type-taxonomy-term-reference field-label-above"><div class="field-label">Tag:&nbsp;</div><div class="field-items"><div class="field-item even"><a href="../tags/docker.html" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">docker</a></div><div class="field-item odd"><a href="../tags/chef.html" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">Chef</a></div><div class="field-item even"><a href="../tags/persistent-data.html" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">persistent data</a></div><div class="field-item odd"><a href="../tags/containers.html" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">containers</a></div><div class="field-item even"><a href="../tags/lwrp.html" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">lwrp</a></div><div class="field-item odd"><a href="../tags/automation.html" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">automation</a></div></div></div>      </footer>
    </article>
    </section>

    
  </div>
</div>

  <footer class="footer container">
      <div class="region region-footer">
    <section id="block-block-2" class="block block-block clearfix">

      
  <p>We are technical guys, not copywriters or designers. <span style="color:#FF0000"><em><strong>Please feel free to offer any feeback we need re: this site!</strong></em>  </span>It might make a big difference. And <em>Thanks!</em></p>
<hr /><p class="rtecenter"><a href="mailto:jeff@datafundamentals.com">jeff@datafundamentals.com</a>         @devopsjeff       <a href="mailto:pete@datafundamentals.com">pete@datafundamentals.com</a>      @appwritercom</p>
<hr /><p class="rtecenter">Copyright 2014, 2015 - dataFundamentals</p>

</section>
  </div>
  </footer>
  <script src="../sites/default/files/js/js_L50O_PWoAuMOxVjnzZCkNSSmI0kFwhZsO1_KS8WnGKw.js"></script>
</body>
</html>
